<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Nav-site Pro</title>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC",sans-serif;
            min-height:100vh;
            padding:20px;
            color:#0f172a;
        }
        body::before{
            content:"";
            position:fixed;
            inset:0;
            z-index:-1;
            background:linear-gradient(120deg,#6366f1,#22d3ee,#a78bfa,#6366f1);
            background-size:300% 300%;
            animation:gradient 18s ease infinite;
        }
        @keyframes gradient{
            0%{background-position:0% 50%}
            50%{background-position:100% 50%}
            100%{background-position:0% 50%}
        }

        .container{max-width:1200px;margin:auto}
        .toolbar,.group,.context,.modal{
            background:rgba(255,255,255,.75);
            backdrop-filter:blur(14px);
            border-radius:14px;
        }

        .toolbar{
            padding:12px;
            display:flex;
            gap:10px;
            align-items:center;
            margin-bottom:20px;
        }
        .toolbar h1{font-size:22px}
        .search{flex:1;max-width:220px;padding:6px 10px;border-radius:8px;border:1px solid #ccc}
        .btn{padding:6px 10px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer}

        .group{margin-bottom:18px}
        .group-header{padding:12px 16px;font-weight:600;cursor:grab}

        .cards{
            padding:12px;
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
            gap:10px;
        }
        .card{
            display:flex;
            gap:10px;
            padding:10px;
            border-radius:10px;
            background:#fff;
            cursor:pointer;
        }
        .card:hover{background:#f1f5f9}

        .ico{width:36px;height:36px;border-radius:8px;background:#eef2ff;display:flex;align-items:center;justify-content:center}
        .ico img{width:100%;height:100%;object-fit:contain}
        .info h3{font-size:14px}
        .info p{font-size:12px;color:#64748b}

        .context{
            position:fixed;
            z-index:999;
            padding:6px;
            box-shadow:0 8px 20px rgba(0,0,0,.15);
        }
        .context div{padding:6px 14px;cursor:pointer}
        .context div:hover{background:#e0e7ff}

        .modal-mask{
            position:fixed;inset:0;
            background:rgba(0,0,0,.3);
            display:flex;align-items:center;justify-content:center;
            z-index:1000;
        }
        .modal{
            padding:20px;
            width:320px;
        }
        .modal h3{margin-bottom:12px}
        .modal label{font-size:13px}
        .modal input, .modal textarea{
            width:100%;margin:6px 0 12px;
            padding:6px;border-radius:6px;border:1px solid #ccc;
        }
        .modal-actions{text-align:right}
        .hidden{display:none}
    </style>
</head>

<body>
<div class="container">
    <div class="toolbar">
        <h1 id="title">Nav-site</h1>
        <input id="search" class="search" placeholder="ÊêúÁ¥¢Ôºà/Ôºâ"/>
        <button class="btn" id="exportBtn">ÂØºÂá∫ JSON</button>
        <button class="btn" id="importBtn">ÂØºÂÖ• JSON</button>
        <button class="btn" id="clearBtn">üßπ Ê∏ÖÁ©∫ÈÖçÁΩÆ</button>
    </div>
    <div id="groups"></div>
</div>

<input type="file" id="fileInput" hidden />
<div id="context" class="context hidden"></div>
<div id="modalMask" class="modal-mask hidden"></div>

<script>
    const STORAGE_KEY='nav_site_data_v2';
    const GROUP_ORDER_KEY='nav_group_order';

    let state={config:{},categoryList:[],data:[]};
    const $=id=>document.getElementById(id);
    const save=()=>{
        localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
        localStorage.setItem(GROUP_ORDER_KEY,JSON.stringify(state.categoryList.map(c=>c.id)));
    };

    function autoLogo(url){
        return `https://www.google.com/s2/favicons?sz=64&domain=${new URL(url).hostname}`;
    }

    /* ===== ÂàùÂßãÂåñ ===== */
    function init(){
        const local=localStorage.getItem(STORAGE_KEY);
        if(local) state=JSON.parse(local);
        render();
    }

    /* ===== Ê∏≤Êüì ===== */
    function render(){
        const box=$('groups');box.innerHTML='';
        state.categoryList.forEach(cat=>{
            const g=document.createElement('div');
            g.className='group';
            g.innerHTML=`<div class="group-header">${cat.name}</div><div class="cards"></div>`;
            const cards=g.querySelector('.cards');

            cards.oncontextmenu=e=>{
                e.preventDefault();
                showMenu(e.clientX,e.clientY,[
                    {text:'‚ûï Â¢ûÂä†Á´ôÁÇπ',fn:()=>openSiteModal(null,cat.id)}
                ]);
            };

            state.data.filter(i=>i.categoryId===cat.id).forEach(i=>{
                const c=document.createElement('div');
                c.className='card';
                c.onclick=()=>window.open(i.url,'_blank');
                c.oncontextmenu=e=>{
                    e.preventDefault();
                    showMenu(e.clientX,e.clientY,[
                        {text:'‚úèÔ∏è ÁºñËæë',fn:()=>openSiteModal(i,cat.id)},
                        {text:'üóë Âà†Èô§',fn:()=>deleteSite(i.id)}
                    ]);
                };
                c.innerHTML=`<div class="ico"><img src="${i.logoUrl}"></div>
        <div class="info"><h3>${i.name}</h3><p>${i.desc||''}</p></div>`;
                cards.appendChild(c);
            });
            box.appendChild(g);
        });
    }

    /* ===== Âè≥ÈîÆËèúÂçï ===== */
    const menu=$('context');
    function showMenu(x,y,items){
        menu.innerHTML='';
        items.forEach(i=>{
            const d=document.createElement('div');
            d.innerText=i.text;
            d.onclick=()=>{menu.classList.add('hidden');i.fn()};
            menu.appendChild(d);
        });
        menu.style.left=x+'px';menu.style.top=y+'px';
        menu.classList.remove('hidden');
    }
    document.onclick=()=>menu.classList.add('hidden');

    /* ===== ÁºñËæëÂºπÁ™ó ===== */
    function openSiteModal(item,categoryId){
        const mask=$('modalMask');
        mask.innerHTML=`
    <div class="modal">
      <h3>${item?'ÁºñËæëÁ´ôÁÇπ':'Êñ∞Â¢ûÁ´ôÁÇπ'}</h3>
      <label>ÂêçÁß∞</label>
      <input id="m_name" value="${item?.name||''}">
      <label>ÊèèËø∞</label>
      <textarea id="m_desc">${item?.desc||''}</textarea>
      <label>URL</label>
      <input id="m_url" value="${item?.url||''}">
      <div class="modal-actions">
        <button class="btn" onclick="closeModal()">ÂèñÊ∂à</button>
        <button class="btn" onclick="saveSite(${item?.id||'null'},${categoryId})">‰øùÂ≠ò</button>
      </div>
    </div>`;
        mask.classList.remove('hidden');
    }
    function closeModal(){$('modalMask').classList.add('hidden')}

    function saveSite(id,categoryId){
        const name=$('m_name').value;
        const desc=$('m_desc').value;
        const url=$('m_url').value;
        if(!url)return alert('URL ÂøÖÂ°´');
        if(id){
            const i=state.data.find(i=>i.id===id);
            Object.assign(i,{name,desc,url,logoUrl:autoLogo(url)});
        }else{
            state.data.push({
                id:Date.now(),
                categoryId,
                name,
                desc,
                url,
                logoUrl:autoLogo(url)
            });
        }
        save();closeModal();render();
    }
    function deleteSite(id){
        state.data=state.data.filter(i=>i.id!==id);
        save();render();
    }

    /* ===== Â∑•ÂÖ∑ÊåâÈíÆ ===== */
    $('clearBtn').onclick=()=>{
        if(!confirm('Á°ÆËÆ§Ê∏ÖÁ©∫ÊâÄÊúâÈÖçÁΩÆÔºü'))return;
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(GROUP_ORDER_KEY);
        state={config:{},categoryList:[],data:[]};
        render();
    };

    /* ===== Á©∫ÁôΩÂè≥ÈîÆ ===== */
    document.body.oncontextmenu=e=>{
        if(e.target===document.body||e.target.id==='groups'){
            e.preventDefault();
            showMenu(e.clientX,e.clientY,[
                {text:'‚ûï Â¢ûÂä†Á´ôÁÇπ',fn:()=>openSiteModal(null,state.categoryList[0]?.id)}
            ]);
        }
    };

    init();
</script>
</body>
</html>